<!doctype html>
<html lang="{{ site.locale | slice: 0,2 }}" class="no-js"{% if site.site_theme == "dark" %} data-theme="dark"{% endif %}>
  <head>
    {% include head.html %}
    {% include head/custom.html %}
  </head>

  <body>

    {% include browser-upgrade.html %}
    {% include masthead.html %}

    {{ content }}

    {% include scripts.html %}

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <script>
      // CONFIG FIREBASE
      const firebaseConfig = {
        apiKey: "AIzaSyCu9YBjutCK0UR3EoliYwiNrrKaY8cyt8U",
        authDomain: "ufficiogabrieljones.firebaseapp.com",
        projectId: "ufficiogabrieljones",
        storageBucket: "ufficiogabrieljones.firebasestorage.app",
        messagingSenderId: "754177287030",
        appId: "1:754177287030:web:e4f70d2d3d9c54c1d91057",
        measurementId: "G-HBSRVKC0JQ"
      };

      firebase.initializeApp(firebaseConfig);

      firebase.auth().onAuthStateChanged(user => {
        const currentPath = window.location.pathname.split("/").pop();

        if (user) {
          const email = user.email;
          if (currentPath === "login.html") {
            // Se utente loggato ma su login.html, reindirizza alla home
            window.location.href = "index.html";
          } else {
            // Mostra il messaggio di benvenuto se l'elemento esiste
            const welcomeEl = document.getElementById('welcomeText');
            if (welcomeEl) {
              welcomeEl.textContent = `Benvenuto, ${email}`;
            }
          }
        } else {
          if (currentPath !== "login.html") {
            // Se non loggato e non su login.html, reindirizza a login
            window.location.href = "login.html";
          }
          // Se giÃ  su login.html, non fare nulla per evitare loop
        }
      });

      function logout() {
        firebase.auth().signOut()
          .then(() => {
            window.location.href = "login.html";
          })
          .catch(error => {
            alert("Errore nel logout.");
            console.error(error);
          });
      }
    </script>
  </body>
</html>
